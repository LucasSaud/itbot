
/** 
* This file has been protected.
*/
   
const _0x2966c9=_0x1201;function _0x486d(){const _0x259cd7=['Erro\x20ao\x20conectar:','toISOString','Logs','Messages','DEFLATE','1004310iCyFGy','_cmdPoints','.sql','2023044xfRdml','Erro\x20ao\x20atualizar\x20contato:','Erro\x20ao\x20salvar\x20evento\x20no\x20banco\x20de\x20dados:','error','nodebuffer','[\x20AVISO\x20]\x20Contato\x20salvo\x20no\x20banco\x20de\x20dados:\x20','.zip','dialect','datasource','Blocked','italin_db','dir','unlink','STRING','jszip','mysqldump','416072dIYcpP','findOne','1800230DZNcCI','log','Erro\x20ao\x20criar\x20o\x20backup\x20do\x20banco\x20de\x20dados:','Comando\x20numérico\x20inválido','isBlocked','Usuário\x20não\x20encontrado','init','readFile','italinbot','backup-','defineModels','deliveryOrders','updateContact','CURRENT_TIMESTAMP','writeFile','../conf/config','30sbLANA','sync','ResponseTimes','update','19009944jDJUpm','literal','define','whatsappNumber','version','exports','@s.whatsapp.net','backup','data','Contacts','contactsUpdatePoints','./utils','saveLogs','user','points','lastOrderDate','saveContact','sequelize','host','DataTypes','join','pwd','INTEGER','DATE','create','1608474riFKYP','TEXT','NOW','1.3.0','showLog','523053VbKjpZ','replace'];_0x486d=function(){return _0x259cd7;};return _0x486d();}(function(_0x3427e4,_0x58d5fc){const _0x36b582=_0x1201,_0x5c996d=_0x3427e4();while(!![]){try{const _0x11629b=-parseInt(_0x36b582(0x145))/0x1+-parseInt(_0x36b582(0x161))/0x2+-parseInt(_0x36b582(0x14f))/0x3+-parseInt(_0x36b582(0x15f))/0x4*(-parseInt(_0x36b582(0x171))/0x5)+-parseInt(_0x36b582(0x14c))/0x6+-parseInt(_0x36b582(0x140))/0x7+parseInt(_0x36b582(0x175))/0x8;if(_0x11629b===_0x58d5fc)break;else _0x5c996d['push'](_0x5c996d['shift']());}catch(_0x27689){_0x5c996d['push'](_0x5c996d['shift']());}}}(_0x486d,0x7b744));function _0x1201(_0x4dc3b8,_0x337ae5){const _0x486db2=_0x486d();return _0x1201=function(_0x1201d4,_0x13a497){_0x1201d4=_0x1201d4-0x134;let _0xed2795=_0x486db2[_0x1201d4];return _0xed2795;},_0x1201(_0x4dc3b8,_0x337ae5);}const JSZip=require(_0x2966c9(0x15d)),fs=require('fs')['promises'],path=require('path'),mysqldump=require(_0x2966c9(0x15e)),{Sequelize,DataTypes,Op}=require(_0x2966c9(0x138)),Utils=require(_0x2966c9(0x180)),config=require(_0x2966c9(0x170));class Database{constructor(){const _0x5211d7=_0x2966c9;this[_0x5211d7(0x179)]=_0x5211d7(0x143),this[_0x5211d7(0x13a)]=DataTypes,this['Op']=Op,this[_0x5211d7(0x138)]=new Sequelize(config[_0x5211d7(0x157)]['data']['db'],config['datasource'][_0x5211d7(0x17d)][_0x5211d7(0x134)],config[_0x5211d7(0x157)][_0x5211d7(0x17d)][_0x5211d7(0x13c)],{'host':config['datasource']['data'][_0x5211d7(0x139)],'dialect':config[_0x5211d7(0x157)]['data'][_0x5211d7(0x156)],'logging':config['datasource'][_0x5211d7(0x17d)][_0x5211d7(0x162)],'timezone':'-03:00'}),this[_0x5211d7(0x16b)](),this[_0x5211d7(0x167)]();}async[_0x2966c9(0x167)](){const _0x33525f=_0x2966c9;try{await this[_0x33525f(0x138)]['authenticate'](),this[_0x33525f(0x138)][_0x33525f(0x172)]();}catch(_0x5eaf6f){console[_0x33525f(0x152)](_0x33525f(0x147),_0x5eaf6f);}}async[_0x2966c9(0x16b)](){const _0x4224f8=_0x2966c9;this[_0x4224f8(0x149)]=this[_0x4224f8(0x138)]['define'](_0x4224f8(0x149),{'id':{'type':DataTypes[_0x4224f8(0x13d)],'primaryKey':!![],'autoIncrement':!![]},'logMessage':{'type':DataTypes['TEXT'],'allowNull':![]},'timestamp':{'type':DataTypes[_0x4224f8(0x13e)],'defaultValue':DataTypes[_0x4224f8(0x142)],'allowNull':![]}}),this['Message']=this['sequelize'][_0x4224f8(0x177)](_0x4224f8(0x14a),{'sender':{'type':DataTypes[_0x4224f8(0x15c)],'allowNull':![]},'body':{'type':DataTypes[_0x4224f8(0x141)],'allowNull':![]},'timestamp':{'type':DataTypes[_0x4224f8(0x13e)],'allowNull':![]}}),this[_0x4224f8(0x158)]=this[_0x4224f8(0x138)][_0x4224f8(0x177)]('Blocks',{'id':{'type':DataTypes[_0x4224f8(0x13d)],'autoIncrement':!![],'primaryKey':!![]},'phoneNumber':{'type':DataTypes[_0x4224f8(0x15c)],'allowNull':![],'unique':!![]},'createdAt':{'type':DataTypes[_0x4224f8(0x13e)],'allowNull':!![],'defaultValue':this['sequelize'][_0x4224f8(0x176)]('CURRENT_TIMESTAMP')},'updatedAt':{'type':DataTypes[_0x4224f8(0x13e)],'allowNull':!![],'defaultValue':this[_0x4224f8(0x138)][_0x4224f8(0x176)](_0x4224f8(0x16e))}}),this[_0x4224f8(0x17e)]=this['sequelize'][_0x4224f8(0x177)](_0x4224f8(0x17e),{'whatsappNumber':{'type':DataTypes[_0x4224f8(0x15c)],'primaryKey':!![],'unique':!![]},'deliveryOrders':{'type':DataTypes[_0x4224f8(0x13d)],'defaultValue':0x0},'pickupOrders':{'type':DataTypes[_0x4224f8(0x13d)],'defaultValue':0x0},'lastOrderDate':{'type':DataTypes[_0x4224f8(0x13e)],'defaultValue':DataTypes[_0x4224f8(0x142)]},'points':{'type':DataTypes[_0x4224f8(0x13d)],'defaultValue':0x0},'isMktSent':{'type':DataTypes['BOOLEAN'],'defaultValue':![]},'isInactive':{'type':DataTypes['BOOLEAN'],'defaultValue':![]}}),this[_0x4224f8(0x173)]=this['sequelize'][_0x4224f8(0x177)](_0x4224f8(0x173),{'id':{'type':DataTypes[_0x4224f8(0x13d)],'primaryKey':!![],'autoIncrement':!![]},'sender':{'type':DataTypes[_0x4224f8(0x15c)],'allowNull':![]},'responseTime':{'type':DataTypes[_0x4224f8(0x13d)],'allowNull':![]},'timestamp':{'type':DataTypes['DATE'],'allowNull':![]}},{'timestamps':![]});}async[_0x2966c9(0x181)](_0x2a55a7){const _0x3ec961=_0x2966c9;try{const _0x470902=await this['Logs'][_0x3ec961(0x13f)]({'logMessage':_0x2a55a7});if(config[_0x3ec961(0x144)]===!![])console['log']('Registro\x20de\x20evento\x20salvo.\x20ID:\x20'+_0x470902['id']);}catch(_0x1ff758){console[_0x3ec961(0x152)](_0x3ec961(0x151),_0x1ff758);}}async[_0x2966c9(0x16d)](_0x54ea94,_0x51378d,_0x2b329a){const _0x37ddc5=_0x2966c9;try{const _0x20d2b0=await this[_0x37ddc5(0x17e)][_0x37ddc5(0x160)]({'where':{'whatsappNumber':_0x54ea94}});if(_0x20d2b0){if(_0x51378d===0x1||_0x2b329a===0x1){const _0x4c681e={};_0x51378d===0x1&&(_0x4c681e[_0x37ddc5(0x16c)]=_0x20d2b0[_0x37ddc5(0x16c)]+0x1);_0x2b329a===0x1&&(_0x4c681e['pickupOrders']=_0x20d2b0['pickupOrders']+0x1);_0x4c681e[_0x37ddc5(0x136)]=new Date();const _0x55bec7=await _0x20d2b0[_0x37ddc5(0x174)](_0x4c681e);}}else{if(!Utils[_0x37ddc5(0x165)](_0x54ea94['replace'](_0x37ddc5(0x17b),''))){const _0x375812=await this[_0x37ddc5(0x17e)][_0x37ddc5(0x13f)]({'whatsappNumber':_0x54ea94,'deliveryOrders':_0x51378d===0x1?0x1:0x0,'pickupOrders':_0x2b329a===0x1?0x1:0x0,'lastOrderDate':new Date(),'isMktSent':0x0});}}}catch(_0xc13711){console[_0x37ddc5(0x152)](_0x37ddc5(0x150),_0xc13711);}}async[_0x2966c9(0x137)](_0xa0d7fc){const _0x56751b=_0x2966c9;try{const _0x40fc98=await this['Contacts'][_0x56751b(0x160)]({'where':{'whatsappNumber':_0xa0d7fc[_0x56751b(0x178)]}});if(!_0x40fc98&&!Utils['isBlocked'](_0xa0d7fc[_0x56751b(0x178)][_0x56751b(0x146)](_0x56751b(0x17b),''))){await this['Contacts'][_0x56751b(0x13f)]({'whatsappNumber':_0xa0d7fc['whatsappNumber'],'deliveryOrders':0x0,'pickupOrders':0x0,'lastOrderDate':new Date(),'isMktSent':0x0});if(config[_0x56751b(0x144)]===!![])console[_0x56751b(0x162)](_0x56751b(0x154)+_0xa0d7fc[_0x56751b(0x178)]);}}catch(_0x3a780b){console['error']('[\x20ERRO\x20]\x20Erro\x20ao\x20salvar\x20contato\x20no\x20banco\x20de\x20dados:',_0x3a780b);}}async[_0x2966c9(0x17c)](){const _0x16116d=_0x2966c9;try{this[_0x16116d(0x16b)](),await this['sequelize'][_0x16116d(0x172)]();const _0x293905=new Date()[_0x16116d(0x148)]()[_0x16116d(0x146)](/:/g,'-'),_0x900040=_0x16116d(0x16a)+_0x293905+_0x16116d(0x14e),_0x39a5a4=path[_0x16116d(0x13b)](__dirname,'..',config[_0x16116d(0x15a)]['backup'],_0x900040);await mysqldump({'connection':{'host':'localhost','user':_0x16116d(0x169),'password':'Brx2045rb@','database':_0x16116d(0x159)},'dumpToFile':_0x39a5a4});const _0x2b89ca=new JSZip(),_0x78418f=await fs[_0x16116d(0x168)](_0x39a5a4);_0x2b89ca['file'](_0x900040,_0x78418f);const _0x15517c=_0x16116d(0x16a)+_0x293905+_0x16116d(0x155),_0x131095=path[_0x16116d(0x13b)](__dirname,'..',config['dir']['backup'],_0x15517c),_0x4dc70d=await _0x2b89ca['generateAsync']({'type':_0x16116d(0x153),'compression':_0x16116d(0x14b)});await fs[_0x16116d(0x16f)](_0x131095,_0x4dc70d),await fs[_0x16116d(0x15b)](_0x39a5a4);if(config['showLog']===!![])console[_0x16116d(0x162)]('Backup\x20do\x20banco\x20de\x20dados\x20criado\x20em\x20'+_0x131095);return _0x15517c;}catch(_0x4f969c){return console[_0x16116d(0x152)](_0x16116d(0x163),_0x4f969c),![];}}async[_0x2966c9(0x17f)](_0x78825e,_0x36be41){const _0x109c16=_0x2966c9;try{const _0xa11845=await this[_0x109c16(0x17e)][_0x109c16(0x160)]({'where':{'whatsappNumber':_0x78825e}});if(_0xa11845){if(config[_0x109c16(0x14d)][_0x36be41]!==undefined){const _0x4cd043=config[_0x109c16(0x14d)][_0x36be41];await _0xa11845[_0x109c16(0x174)]({'points':_0xa11845[_0x109c16(0x135)]+_0x4cd043});}else console[_0x109c16(0x152)](_0x109c16(0x164));}else console[_0x109c16(0x152)](_0x109c16(0x166));}catch(_0x1cb612){console[_0x109c16(0x152)]('Erro\x20ao\x20atualizar\x20os\x20pontos\x20do\x20usuário:',_0x1cb612);}}}module[_0x2966c9(0x17a)]=Database;
   